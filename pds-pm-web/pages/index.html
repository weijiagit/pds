<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>项目管理系统</title>
<!-- Tell the browser to be responsive to screen width -->
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<!-- css -->
<link rel="stylesheet" href="../ui/bootstrap/css/bootstrap.css">
<link rel="stylesheet" href="../ui/plugins/font-awesome/css/font-awesome.css">
<link rel="stylesheet" href="../ui/plugins/datatables/dataTables.bootstrap.css">
<link rel="stylesheet" href="../ui/dist/self/css/ionicons.min.css">
<link rel="stylesheet" href="../ui/dist/css/AdminLTE.css">
<link rel="stylesheet" href="../ui/dist/css/skins/_all-skins.css">
<link rel="stylesheet" href="../ui/plugins/iCheck/flat/blue.css">
<link rel="stylesheet" href="../ui/plugins/iCheck/all.css">
<link rel="stylesheet" href="../ui/plugins/colorpicker/bootstrap-colorpicker.min.css">
<link rel="stylesheet" href="../ui/plugins/timepicker/bootstrap-timepicker.min.css">
<!--<link rel="stylesheet" href="../ui/plugins/datepicker/datepicker3.css}">-->
<link rel="stylesheet" href="../ui/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">
<!--<link rel="stylesheet" href="../ui/plugins/bootstrap-datetimepicker/css/datetimepicker.css}">-->
<link rel="stylesheet" href="../ui/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
<link rel="stylesheet" href="../ui/dist/self/css/webshowcase.css">
<link rel="stylesheet" href="../ui/plugins/blueimp-gallery/blueimp-gallery.min.css">
<link rel="stylesheet" href="../ui/plugins/toast/jquery.toast.min.css">
<link rel="stylesheet" href="../ui/plugins/jquery-confirm/jquery-confirm.css">
<link rel="stylesheet" href="../ui/plugins/jstree/themes/default/style.min.css">
<link rel="stylesheet" href="../ui/dist/core/core.css">
<link rel="stylesheet" href="../ui/dist/core/animation.css">

<link rel="stylesheet" href="../ui/dist/css/global.css">
<link rel="stylesheet" href="../ui/dist/css/newstyle.css">

<!-- js -->
	<!--ueditor begin -->
	<!-- <script type="text/javascript" src="../ui/ueditor/ueditor.config.js"></script>
	<script type="text/javascript" src="../ui/ueditor/ueditor.all.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="../ui/ueditor/lang/zh-cn/zh-cn.js"></script> -->
	<!-- ueditor end -->
<script type="text/javascript" src="../ui/dist/self/js/config.js"></script>
<script type="text/javascript" src="../ui/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<script type="text/javascript" src="../ui/plugins/blueimp-gallery/blueimp-gallery.min.js"></script>
<script type="text/javascript" src="../ui/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../ui/dist/self/js/jquery.form.js"></script>
<script type="text/javascript" src="../ui/plugins/jquery-validation/jquery.validate.js"></script>
<script type="text/javascript" src="../ui/plugins/jquery-validation/additional-methods.js"></script>
<script type="text/javascript" src="../ui/plugins/jquery-confirm/jquery-confirm.js"></script>
<script type="text/javascript" src="../ui/plugins/datatables/jquery.dataTables.js"></script>
<script type="text/javascript" src="../ui/plugins/datatables/dataTables.bootstrap.js"></script>
<!--<script type="text/javascript" src="../ui/plugins/datepicker/bootstrap-datepicker.js"></script>-->
<!--<script type="text/javascript" src="../ui/plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script>-->

<script type="text/javascript" src="../ui/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" src="../ui/plugins/bootstrap-datetimepicker/locales/bootstrap-datetimepicker.zh-CN.js"></script>

<script type="text/javascript" src="../ui/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<script type="text/javascript" src="../ui/plugins/toast/jquery.toast.min.js"></script>
<script type="text/javascript" src="../ui/plugins/toast/alertTool.js"></script>
<script type="text/javascript" src="../ui/plugins/jstree/jstree.js"></script>
<script type="text/javascript" src="../ui/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<script type="text/javascript" src="../ui/plugins/fastclick/fastclick.js"></script>
<script type="text/javascript" src="../ui/dist/js/app.min.js"></script>
<script type="text/javascript" src="../ui/dist/js/demo.js"></script>
<script type="text/javascript" src="../ui/plugins/select2/select2.full.min.js"></script>
<script type="text/javascript" src="../ui/plugins/input-mask/jquery.inputmask.js"></script>
<script type="text/javascript" src="../ui/plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
<script type="text/javascript" src="../ui/plugins/input-mask/jquery.inputmask.extensions.js"></script>
<script type="text/javascript" src="../ui/plugins/iCheck/icheck.min.js"></script>
<script type="text/javascript" src="../ui/plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
<script type="text/javascript" src="../ui/plugins/timepicker/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="../ui/dist/self/js/httpservice.js"></script>
<script type="text/javascript" src="../ui/dist/self/js/util.js"></script>
<script type="text/javascript" src="../ui/dist/self/js/datatables.js"></script>
<script type="text/javascript" src="../ui/dist/self/js/validate_zh.js"></script>
<script type="text/javascript" src="../ui/plugins/avalon/avalon.js"></script>
<script type="text/javascript" src="../ui/dist/self/js/simplefile.js"></script>
<script type="text/javascript" src="../ui/dist/js/echarts.common.min.js"></script>

</head>

<body class="sidebar-mini wysihtml5-supported skin-green-light fixed">
	<div class="wrapper">
		<header class="main-header">
			<!-- Logo -->
			<a href="index.html" class="logo"> <!-- mini logo for sidebar mini 50x50 pixels --> <span class="logo-mini"></span> <!-- logo for regular state and mobile devices -->
				<!-- <span class="logo-lg">平顶山高新区项目管理系统</span> -->
				<span class="logo-lg"></span>
			</a>
			<!-- Header Navbar: style can be found in header.less -->
			<nav class="navbar navbar-static-top">
				<!-- Sidebar toggle button-->
				<a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button"> <span class="sr-only">Toggle navigation</span>
				</a>
				<div class="pds-title">平顶山高新区项目管理系统</div>
				<a href="javascript:;" class="logout" id="loginout_link">退出</a>
				<span class="date" id="currentDate"></span>
				<div class="username-wrap">
					<span id="username"></span>，欢迎您！
				</div>
				<!-- <div class="navbar-custom-menu">
					<ul class="nav navbar-nav">
						<li class="dropdown user user-menu"><a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown">
								<span class="hidden-xs" th:text="${user.userName}"></span>
						</a>
							<ul class="dropdown-menu">

							</ul></li>
						<li><a href="javascript:void(0)"   id="updatePassword_link">
						<i class="fa fa-key"></i> 修改密码</a></li>
						<li><a href="javascript:void(0)"  id="loginout_link"> <i class="fa fa-sign-out"></i>退出
						</a></li>
					</ul>
				</div>-->
			</nav>
		</header>

		<namespace id="main-siderbar">
		<aside class="main-sidebar skin-blue-light left-side">
			<section class="sidebar" id="sidebar">
				<ul class="sidebar-menu" id="sidebar-menu">
				</ul>
			</section>
		</aside>
		</namespace>

		<script type="text/javascript">
			var page = {
				namespace : $('#main-siderbar').namespace(),
				init : function() {

					page.loadData();
                    page.loadRoleList();
                    page.getLoginName();
				},
				getLoginName : function() {
                    var HtmlMenuOpt = {
                        endpoint : "/login/getsessionUser",
                        success : function(data) {
                            $("#username").html(data.natureName);
                        }
                    };
                    page.namespace.getRequest(HtmlMenuOpt);
				},
				loadData : function() {
					var HtmlMenuOpt = {
						endpoint : "/sysmenu/loadMenuTreeUser",
						data : {},
						success : function(data) {
							page.createMenu(data);
							page.toIndex();
						}
					};
					page.namespace.getRequest(HtmlMenuOpt);
				},
				loadRoleList : function () {
                    var HtmlMenuOpt = {
                        endpoint : "/login/getRoleList",
                        success : function(data) {
                            //
							/*var map =new Map();
                            for(var i=0;i<localStorage.length;i++){
                                var key = localStorage.key(i);
                                var value = localStorage.getItem(key);
                                map.set(key,value);
                                console.log(key)
                            }
							map.forEach(function (element, index, array){
                                if(element != "_redis_token"){
                                    localStorage.removeItem(element);
                                }
							});*/


                            sessionStorage.clear();
                            for(var j =0 ;j<data.length;j++){
                                var key = data[j];
                                var value = data[j];
                                console.log("==="+key)
                                sessionStorage.setItem(key,value);
							}

                        }
                    };
                    page.namespace.getRequest(HtmlMenuOpt);
                },
				createMenu : function(data) {
					var html = "";
					html += "<li class='active treeview'>" + "<a href='#' id='toIndex' href-htmlurl='/pages/home.html' href-layoutid='main-bodyindex' onclick='page.menuhref(this)'>" + "<i class='ico-l'></i> <span>首页</span></a>";
					$("#sidebar-menu").append(html);
					for ( var o in data) {
						$("#sidebar-menu").append(page.getMenuHtml(data[o]));
					}
				},
				getMenuHtml : function(data) {
					var html = "<li class='active treeview'>" + "<a href='#'>" + "<i class='ico-l'></i> <span>"
					/* + data.entity.name */
					+ data.text + "</span> <i class='fa fa-angle-left pull-right'></i></a>";

					html += page.getChildHtml(data);

					return html;
				},
				getChildHtml : function(data) {
					var html = " <ul class=\"treeview-menu\">";
					var _l_html;

					/* for ( var o in data.childrens) { */
					for ( var o in data.children) {

						/* var children = data.childrens[o]; */
						var children = data.children[o];

						/* if(!!children.childrens) { */
						if (!!children.children) {
							_l_html = "<li style='line-height:32px;'><a href='#'><i class='icon'></i>" + children.text + "</a>"
									+ page.getChildHtml(children) + "</li>";
						} else {
							_l_html = " <li style='line-height:32px;'><a href='javascript:void(0)' href-htmlUrl='" + children.entity.url
									+ "' href-layoutId='" + children.entity.layout + "' onclick='page.menuhref(this)'><i class='icon'></i>"
									/* + children.entity.name + "</a></li>" */
									+ children.text + "</a></li>"
						}

						html += _l_html;
					}

					html += "</ul>";
					return html;
				},
				menuhref : function(obj) {
					$(obj).parent().addClass("active");
					$(obj).parent().siblings().removeClass("active");
					var url = $(obj).attr("href-htmlUrl");
					var layoutId = $(obj).attr("href-layoutId");
					page.namespace.skiphtml(url);
				},
				toIndex : function() {
					var url = "/pages/home.html";
					var layoutId = "main-bodyindex";
					page.namespace.skiphtml(url);
				}
			}

			page.init();
			

			$('#loginout_link').on('click',function(){

				var HtmlMenuOpt = {
						endpoint : "/sso/ssoLogOut",
						success : function(data) {
							httpservice.token.remove();
						}
					};
					page.namespace.postRequest(HtmlMenuOpt);

			});

			$('#updatePassword_link').on('click',function(){

				page.namespace.modal.open(page,
						{	id:"updatePasswordModal",
							title:"密码修改",
							hidden : function(e,ra){
								//alert("hide modal  "+ JSON.stringify(ra[0]) );
							}
						},'/pages/updatePassword.html',{id : '090909' , name : 'passwordAgain' });
			});


		</script>

		<div class="content-wrapper-boot">
			<div id="rightRefreshDiv" class="content-wrapper"></div>
		</div>

		<!--<footer class="main-footer">-->
		<!--<div class="pull-right hidden-xs">-->
		<!--<b>Version</b> 0.0.1-->
		<!--</div>-->
		<!--<strong>Copyright &copy; 2016-2020 Admin Console</strong> All rights reserved.-->
		<!--</footer>-->

		<aside class="control-sidebar control-sidebar-dark">
			<!-- Create the tabs -->
			<ul class="nav nav-tabs nav-justified control-sidebar-tabs">

				<li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>

			</ul>
			<!-- Tab panes -->
			<div class="tab-content">
				<!-- Home tab content -->
				<div class="tab-pane" id="control-sidebar-home-tab">
					<!-- /.control-sidebar-menu -->
					<!-- /.control-sidebar-menu -->
				</div>
			</div>
		</aside>
	</div>
</body>

<script type="text/javascript">
	$(function() {
		$.validator.addMethod("valueNotEquals", function(value, element, arg) {
			return arg != value;
		}, "必选字段");

	});
	$(document).ready(function() {
		Date.prototype.Format = function (fmt) { //author: meizz 
			var o = {
			    "M+": this.getMonth() + 1, //月份 
			    "d+": this.getDate(), //日 
			    "h+": this.getHours(), //小时 
			    "m+": this.getMinutes(), //分 
			    "s+": this.getSeconds(), //秒 
			    "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
			    "S": this.getMilliseconds() //毫秒 
			};
			if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
			for (var k in o)
			if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
			return fmt;
		}
		// var newDate = new Date();
		// console.log(newDate.Format("yyyy-MM-dd hh:mm:ss"));
		function setTime(){
			$("#currentDate").html(new Date().Format("yyyy-MM-dd hh:mm:ss"));
		}
		setInterval(setTime, 1000);
	});
	$(document).ready(function() {
		$(".sidebar-menu").on("click","li",function(){
			$("body").find(".datetimepicker").remove();
			$(this).parents(".treeview").siblings('.treeview').children(".treeview-menu").children("li").removeClass("active");
		})
	});

</script>
</html>
